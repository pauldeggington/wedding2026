<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Wedding Gallery</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background: #fdf6f6;
            margin: 0;
            padding: 20px;
        }

        .btn {
            background: #ff4d6d;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            margin-bottom: 30px;
        }

        #gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        #gallery img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>

    <h1>Welcome to Our Wedding! ðŸ¥‚</h1>
    <p>Snap a photo and share it with us live.</p>

    <button id="upload_widget" class="btn">ðŸ“¸ Upload Photo</button>

    <div id="gallery"></div>

    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

    <script>
        const cloudName = "YOUR_CLOUD_NAME"; // Find this in your Cloudinary Dashboard
        const unsignedUploadPreset = "YOUR_PRESET_NAME"; // The preset you created

        // 3. Initialize Upload Widget
        var myWidget = cloudinary.createUploadWidget({
            cloudName: cloudName,
            uploadPreset: unsignedUploadPreset,
            sources: ['local', 'camera'], // Allow file pick or live camera
            multiple: true
        }, (error, result) => {
            if (!error && result && result.event === "success") {
                loadGallery(); // Reload gallery immediately when a photo is uploaded
            }
        });

        document.getElementById("upload_widget").onclick = () => myWidget.open();

        // 4. Fetch and Show "Live" Photos
        function loadGallery() {
            // This fetches every image with the tag 'wedding_live'
            fetch(`https://res.cloudinary.com/${cloudName}/image/list/wedding_live.json`)
                .then(response => response.json())
                .then(data => {
                    const galleryDiv = document.getElementById('gallery');
                    galleryDiv.innerHTML = ''; // Clear current photos
                    data.resources.forEach(img => {
                        const imgUrl = `https://res.cloudinary.com/${cloudName}/image/upload/w_400,c_fill/${img.public_id}.${img.format}`;
                        const el = document.createElement('img');
                        el.src = imgUrl;
                        galleryDiv.appendChild(el);
                    });
                })
                .catch(err => console.log("Gallery is empty or error loading."));
        }

        // Auto-refresh every 30 seconds to keep it "Live"
        setInterval(loadGallery, 30000);
        loadGallery(); // Initial load
    </script>
</body>

</html>